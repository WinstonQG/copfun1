!function(e){"use strict";AWEContent.Models.DrupalFieldItem=AWEContent.Models.Item.extend({defaults:{machine_name:"drupal_field",nodeType:"",fieldName:"",lgResponsive:!0,xsResponsive:!0,mediumResponsive:!0,smResponsive:!0},createView:function(){this.view=new AWEContent.Views.DrupalFieldItem({model:this})},removePanelView:function(){AWEContent.Toolbars.drupal.showController("field-"+this.get("fieldName")),AWEContent.Models.Item.prototype.removePanelView.call(this)}}),AWEContent.Views.DrupalFieldItem=AWEContent.Views.Item.extend({renderItemContent:function(){var t=this,i=this.model.toJSON();switch(t.$el.addClass("awe-drupal-field-item"),this.model.get("fieldName")){case"invisible":t.$el.prepend('<div class="awe-field-loaded">This field is used in another place on this page</div>').addClass("awe-item-unload");break;default:t.$el.prepend('<div class="awe-item-preload"></div>'),e.post(AWEContent.Path.drupalElementURL,{type:this.model.get("machine_name"),nodeType:this.model.get("nodeType"),fieldName:this.model.get("fieldName"),formData:e(".awecontent-body-wrapper .node-form").serialize()},function(i){var n=i.fieldContent?i.fieldContent:'<div class="ac-field-content">'+Drupal.t("Field content")+"</div>";t.$el.prepend(n),e(".awe-item-preload",t.$el).remove(),i.field_not_exist&&t.$el.addClass("awe-item-unload"),AWEContent.Toolbars.drupal.hideController("field-"+t.model.get("fieldName"))})}i.xsResponsive||t.$el.addClass("xs-hidden"),i.smResponsive||t.$el.addClass("sm-hidden"),i.mediumResponsive||t.$el.addClass("md-hidden"),t.$el.defaultResponsive(i)}}),AWEContent.Views.DrupalFieldController=AWEContent.Views.ItemController.extend({machineName:"drupal_field",el:"li.ac-dp-field",existingElement:!0,createItemModel:function(t){if(void 0!=t){var i="field-"+t.fieldName,n=e.inArray(i,AWEContent.Toolbars.drupal.loadedElements);return n>-1&&(t.fieldName="invisible"),new AWEContent.Models.DrupalFieldItem(t)}return null},applySettingsChanged:function(t){var i=this;e.each(t.changedAttributes(),function(e,t){i.$el.changeResponsive(e,t)})}}),AWEContent.Views.DrupalFieldPanel=AWEContent.Views.ItemPanel.extend({panelName:"drupal_field",el:"#drupal-field-panel",className:"awe-obj-panel drupal-field-panel",initialize:function(){this.initialized=!0,AWEContent.Views.ItemPanel.prototype.initialize.call(this);var t=this;e("form.node-form #edit-actions input").click(function(){e("input[type=submit]",e(this).parents("form")).removeAttr("clicked"),e(this).attr("clicked",!0)}),e("form.node-form").submit(function(i){"edit-view-field"==e("#edit-actions input[clicked=true]",e(this)).attr("id")&&(i.preventDefault(),t.getFieldContent(e(this)))}).bind("getFieldContentSuccess",function(i,n){t.editingModel.view.$el.children(":not(.awe-custom)").remove(),t.editingModel.view.$el.prepend(n.fieldContent),n.field_not_exit&&t.$el.addClass("awe-item-unload"),AWEContent.Toolbars.drupal.hideController("field-"+t.editingModel.get("fieldName")),e(".awe-item-preload",t.editingModel.view.$el).remove(),t.closePanel()})},getFieldContent:function(t){var i=this,n=i.editingModel.get("fieldName").replace(/_/g,"-"),l=e(".field-name-"+n,t);l.data("second-load")||i.editingModel.view.$el.prepend('<div class="awe-item-preload"></div>'),e.ajax({url:AWEContent.Path.drupalElementURL,type:"POST",data:{formData:t.serialize(),fieldName:i.editingModel.get("fieldName"),type:"drupal_field",nodeType:e("#edit-actions input[clicked=true]",t).data("node-type")},success:function(n){n.status?e(".ckeditor-mod",l).length&&!l.data("second-load")?(i.getFieldContent(t),l.data("second-load",1)):(t.trigger("getFieldContentSuccess",n),l.data("second-load",0)):e(".ac-form-messages",i.$el).html(n.error)}})},initPanel:function(){e('<div class="ac-form-messages"></div>').insertAfter(e(".md-section",this.$el).prev())},openPanel:function(){AWEContent.Views.ItemPanel.prototype.openPanel.call(this);var t=e(".node-form",this.$el),i=this.editingModel.get("fieldName").replace(/_/g,"-");this.$el.addClass(this.className),this.resetNodeForm(t),e("> div > .form-item, > div > .form-wrapper:not(.form-actions), .vertical-tabs, .awe-control-buttons",t).hide(),e(".field-name-"+i,t).show(),e("#edit-actions input:not(#edit-view-field)",t).hide(),e("#edit-actions input#edit-view-field",t).show(),this.$el.addClass("large-panel")},closePanel:function(){AWEContent.Views.ItemPanel.prototype.closePanel.call(this),this.$el.removeClass("large-panel"),this.resetNodeForm(e("form",this.$el))},resetNodeForm:function(t){e("> div > .form-item, > div > .form-wrapper, .vertical-tabs, .awe-control-buttons",t).show(),e("#edit-actions input:not(#edit-view-field)",t).show(),e("#edit-actions input#edit-view-field",t).hide(),e(".ac-form-messages",this.$el).html("")},buildPanel:function(){return{wrapper:{type:"section"}}}}),e(document).ready(function(){AWEContent.Controllers.drupal_field=new AWEContent.Views.DrupalFieldController,AWEContent.Panels.drupal_field=new AWEContent.Views.DrupalFieldPanel})}(jQuery);