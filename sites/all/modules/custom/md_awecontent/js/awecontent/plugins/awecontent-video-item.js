!function(e){"use strict";AWEContent.Models.VideoItem=AWEContent.Models.Item.extend({defaults:{machine_name:"video",linkVideo:"",linkProcessed:"",typeThumb:"auto",indexThumbAuto:0,srcThumbAuto:"",srcThumbCustom:"",thumbStyle:"none",typePlay:"inline",heightVideo:-1,backgroundColor:"",boxModelSettings:{},customID:"",customClass:"",customEnableAttributes:0,customDataAttributes:"[] ",customActionAttributes:'{"newAction": "", "newAttrName": "", "newAttrValue": ""}',customEnableAnimations:0,customDataAnimations:'{"type" : "none"}',lgResponsive:!0,xsResponsive:!0,mediumResponsive:!0,smResponsive:!0},relations:[{type:Backbone.HasOne,key:"boxModelSettings",relatedModel:AWEContent.Models.BoxModelSettings}],createView:function(){this.view=new AWEContent.Views.VideoItem({model:this})},clone:function(){var t={};return e.each(this.toJSON(),function(e,i){t[e]=i}),t.boxModelSettings=new AWEContent.Models.BoxModelSettings(t.boxModelSettings),new AWEContent.Models.VideoItem(t)}}),AWEContent.Views.VideoItem=AWEContent.Views.Item.extend({additionalEvents:{"click .thumb-video":"showIframe"},showIframe:function(t){var i=e(t.target).hasClass("thumb-video")?e(t.target):e(t.target).closest(".thumb-video"),a=i.nextAll("iframe"),o=i.nextAll("a"),n=this.model.toJSON();"lightbox"==n.typePlay?AWEContent.jqIframe(o).trigger("click"):"inline"==n.typePlay&&(i.hide(),a.show().attr("src",this.model.toJSON().linkProcessed))},initialize:function(){AWEContent.Views.Item.prototype.initialize.call(this),this.listenTo(this.model.get("boxModelSettings"),"change",this.applySettingsChanged)},renderItemContent:function(){function t(){AWEContent.jqIframe(l).magnificPopup({disableOn:700,prependTo:".awe-page-wrapper",type:"iframe",mainClass:"mfp-fade",removalDelay:160,preloader:!1,fixedContentPos:!1})}var i=this,a=i.model.toJSON(),o=e('<div class="awe-item awe-video"><div class="thumb-video"><div class="image-content"><img src="" alt=""/></div><div class="play-control"><i class="ic ac-icon-play"></i></div></div><a href="" class="mfp-md-video"></a><iframe class="" src=""></iframe></div>'),n=e("img",o),s=e("iframe",o),l=e("a",o);if(AWEContent.Library.addLibrary("magnific",function(){t()}),l.attr("href",a.linkVideo),"auto"==a.typeThumb?n.attr("src",a.srcThumbAuto):n.attr("src",a.srcThumbCustom),"autoInline"==a.typePlay&&(n.closest(".thumb-video").hide(),s.attr("src",a.linkProcessed).show()),o.css({height:-1!=a.heightVideo?a.heightVideo+"px":""}),n.css("background-color",a.backgroundColor),o.attr("id",a.customID).addClass(a.customClass).renderItemDefaultAttributes(a.customEnableAttributes,a.customDataAttributes),o.renderItemDefaultBoxModel(a.boxModelSettings),a.customEnableAnimations){var d=a.customDataAnimations;o.processAnimations(d)}return i.$el.defaultResponsive(a),o},applySettingsChanged:function(t){var i=this,a=e(".awe-video",i.el),o=e(".thumb-video",a),n=(e("img, iframe",a),e("img",a)),s=e("a",a),l=e("iframe",a),d=t.toJSON(),u=i.$el.height();e.each(t.changedAttributes(),function(u,c){switch(i.$el.changeResponsive(u,c),a.renderChangeSettingBoxModel(u,c,t),u){case"linkVideo":s.attr("href",c);break;case"linkProcessed":"autoInline"==d.typePlay?l.attr("src",c):(l.attr("src",""),o.show());break;case"typeThumb":"auto"==c?n.attr("src",d.srcThumbAuto):n.attr("src",d.srcThumbCustom);break;case"srcThumbAuto":"auto"==d.typeThumb&&n.attr("src",c);break;case"thumbStyle":var r=d.fidThumbCustom,m=d.thumbStyle;r&&e.ajax({type:"POST",url:AWEContent.Path.imageStyleURL,data:{fids:""+r,styles:m},success:function(e){i.model.set("srcThumbCustom",e[r][m]),AWEContent.Panels.video.$el.find("#video-upload-thumbnail .image-content").attr("src",e[r][m])}});break;case"srcThumbCustom":"custom"==d.typeThumb&&n.attr("src",c);break;case"typePlay":"autoInline"==c?(o.hide(),l.show().attr("src",d.linkProcessed)):(o.show(),l.hide().attr("src",""));break;case"heightVideo":a.css("height",-1!=c?c+"px":"");break;case"backgroundColor":o.css("background",c);break;case"customID":a.attr("id",c);break;case"customClass":var h=i.model.previousAttributes().customClass;a.removeClass(h).addClass(c);break;case"customEnableAttributes":a.renderChangeSettingsAttributes(u,c,d.customDataAttributes);break;case"customActionAttributes":a.renderChangeSettingsAttributes(u,c);break;case"customEnableAnimations":var v,b;c?(v=d.customDataAnimations,b=null,a.processAnimations(v)):(v=null,b=d.customDataAnimations,a.processAnimations(v,b));break;case"customDataAnimations":var v,b;v=d.customDataAnimations,b=i.model.previousAttributes().customDataAnimations,a.processAnimations(v,b)}}),setTimeout(function(){i.checkChangeHeight(u)},50)}}),AWEContent.Views.VideoItemController=AWEContent.Views.ItemController.extend({machineName:"video",controllerHtml:function(){return'<div class="title-icon">Video</div><i class="ic ac-icon-video"></i>'},createItemModel:function(e){var t;return void 0!=e?(t=new AWEContent.Models.BoxModelSettings(e.boxModelSettings),e.boxModelSettings=t,new AWEContent.Models.VideoItem(e)):new AWEContent.Models.VideoItem({boxModelSettings:new AWEContent.Models.BoxModelSettings})}}),AWEContent.Views.VideoPanel=AWEContent.Views.ItemPanel.extend({tagName:"div",className:"awe-obj-panel video-panel",panelName:"video",initPanel:function(){AWEContent.Views.ItemPanel.prototype.initPanel.call(this);var t=this;e(".thumb-container",t.el).attr("id","video-upload-thumbnail").aweUploadImageInit(),e(".slide-image-container",t.el).attr("id","video-slide-thumbnail").aweSlideImageInit(),e(".color-picker",t.el).append('<input type="hidden" name="changing-color">'),e("#text-video-link-video",t.el).change(function(){var i=e.processVideo(e(this).val()),a=i.attrVideo.replace("autoplay=0","autoplay=1");t.editingModel.set("linkVideo",e(this).val()),t.editingModel.set("linkProcessed",a),e("#video-slide-thumbnail input[name=custom_image]",t.el).val(0).trigger("change")}),e("#video-select-thumb",t.el).change(function(i,a){t.editingModel.set("typeThumb",a.value),"auto"==a.value?(e("#video-slide-thumbnail",t.el).show(),e("#video-upload-thumbnail",t.el).hide()):(e("#video-slide-thumbnail",t.el).hide(),e("#video-upload-thumbnail",t.el).show())}),e("#video-slide-thumbnail input[name=custom_image]",t.el).change(function(){var i=parseInt(e(this).val()),a=e(this).closest(".slide-image-container"),o=t.editingModel.get("linkVideo"),n=e.processVideo(o),s=n.id.trim(),l=n.typeVideo,d=e(this).closest(".slide-image-container").prev("#video-select-thumb"),u=(e("input[name=selected_value]",d).val(),e(this).prev(".slide-image-controls"));if(e("img",a).removeClass("active"),"youtube"==l){u.show(),e.each(e("img",a),function(){var t=e(this).index();""!=s?e(this).attr("src","http://img.youtube.com/vi/"+s+"/"+t+".jpg"):e(this).attr("src","http://img.youtube.com/vi/"+t+".jpg")});var c=e("img",a).eq(i).addClass("active").attr("src");e("img",a).eq(i).addClass("active"),t.editingModel.set("indexThumbAuto",i),t.editingModel.set("srcThumbAuto",c)}else"vimeo"==l&&e.ajax({type:"GET",url:"http://vimeo.com/api/v2/video/"+s+".json",jsonp:"callback",dataType:"jsonp",success:function(i){u.hide();var o=i[0].thumbnail_large;t.editingModel.set("indexThumbAuto",0),t.editingModel.set("srcThumbAuto",o),e("img",a).eq(0).attr("src",o).addClass("active")}})}),e("#video-upload-thumbnail input[name=selected_media]",t.el).change(function(){var i,a=e(this).prev().find("img"),o=e(this).val(),n=t.editingModel.get("thumbStyle");""!=o&&(o=e.parseJSON(o),""!=AWEContent.Path.imageStyleURL?e.ajax({type:"POST",url:AWEContent.Path.imageStyleURL,data:{fids:""+o.fid,styles:n},success:function(s){"string"==e.type(s)&&(s=JSON.parse(s.trim())),i=s[o.fid][n],t.editingModel.set({srcThumbCustom:i,fidThumbCustom:o.fid}),a.attr("src",i)}}):(i=o.file_url,t.editingModel.set("srcThumbCustom",i),a.attr("src",i)))}),e("#video-thumb-style",this.el).change(function(e,i){t.editingModel.set("thumbStyle",i.value)}),e("#video-play-video",t.el).change(function(e,i){t.editingModel.set("typePlay",i.value)}),e("#video-height-video",t.el).change(function(i,a){t.editingModel.set("heightVideo",a.value),-1==a.value&&e(".display-font",e(this)).text("DF")}),e("#video-background-color",t.el).change(function(e,i){i=i?i.toRgbString():"",t.editingModel.set("backgroundColor",i)}),e("#video-layout-tab",t.el).initBoxModelPanel(t,"boxModelSettings"),e("#text-video-custom-id",this.el).change(function(){t.editingModel.set("customID",e(this).val())}),e("#text-video-custom-classes",this.el).change(function(){t.editingModel.set("customClass",e(this).val())}),e("#video-custom-attributes",this.el).initAttributesPanel(t),e("#video-animations input[name=enabled_custom_animation]",this.el).change(function(i,a){t.editingModel.set("customEnableAnimations",parseInt(e(this).val())),a&&t.editingModel.set("customDataAnimations",JSON.stringify(a.animations))})},setPanelElementsValue:function(){var t=this,i=this.editingModel.toJSON();e("#text-video-link-video",t.el).val(i.linkVideo).trigger("change"),e("#video-select-thumb",t.el).aweSelect("value",i.typeThumb),e("#video-slide-thumbnail input[name=custom_image]",t.el).val(i.indexThumbAuto).trigger("change",{isCustom:!0}),e("#video-upload-thumbnail .image-content",t.el).attr("src",i.srcThumbCustom),""!=AWEContent.Path.imageStyleURL?e("#video-thumb-style",t.el).aweSelect("value",i.thumbStyle):e("#video-thumb-style",t.el).remove(),e("#video-play-video",t.el).aweSelect("value",i.typePlay),e("#video-height-video",t.el).aweSlider("value",i.heightVideo),e("#video-background-color",t.el).aweColorPicker("value",i.backgroundColor),e("#video-layout-tab",t.el).initBoxModel(i.boxModelSettings),e("#text-video-custom-id",t.el).val(i.customID),e("#text-video-custom-classes",t.el).val(i.customClass),e("#video-custom-attributes input[name=enabled_custom_attributes]",t.el).val(i.customEnableAttributes).trigger("change"),e("#video-custom-attributes input[name=attributes_data]",t.el).val(i.customDataAttributes),e("#video-custom-attributes",this.el).initAttributes(i.customEnableAttributes,i.customDataAttributes),e("#video-animations input[name=enabled_custom_animation]",this.el).val(i.customEnableAnimations).trigger("change"),e("#video-animations input[name=enabled_custom_animation]",this.el).attr("data-animations",i.customDataAnimations).data("view",this.editingModel.view)},buildPanel:function(){return{title:{type:"markup",markup:'<div class="awe-title"><h2>Video</h2></div>'},"information-video":{type:"section",link_video:{type:"text_field",title:"Link",placeholder:"http://...",default_value:""},select_thumb:{type:"select",title:"Thumb",options:{auto:"Auto",custom:"Custom"},default_value:"custom"},slider_thumbnail:{type:"markup",markup:'<div class="slide-image-container"><div class="list-image"><img src="" alt=""/><img src="" alt=""/><img src="" alt=""/><img src="" alt=""/></div><div class="slide-image-controls"><i class="nav-prev ic ac-icon-arrow-left"></i><i class="nav-next ic ac-icon-arrow-right"></i></div><input type="hidden" name="custom_image" value=""/></div>'},upload_thumbnail:{type:"markup",markup:'<div class="thumb-container"><div class="controls-upload ic ac-icon-upload"></div><div class="image-container"><img class="image-content" src="" alt=""/><div class="remove-image ic ac-icon-clear"></div></div><input type="hidden" name="selected_media" value=""/></div>'},thumb_style:{type:"image_style_list",title:"Thumbnail Style",default_value:"none",attributes:{"class":["long-title"]}},play_video:{type:"select",title:"Play",options:{autoInline:"Auto play inline",inline:"Inline",lightbox:"Play in lightbox"},default_value:"inline"},height_video:{type:"slider",title:"Height",min_value:-1,max_value:1e3,unit:"px",default_value:20,allow_type:!0},background_color:{type:"colorpicker",title:"Background color",options:{preferredFormat:"rgb",AlphaVerticle:!0,showAlpha:!0,allowEmpty:!0,showInput:!0}}},box_settings:{type:"section",layout_tab:{type:"tabs",tabs:[{tab_title:"Border",contents:{video_border:{type:"box_border",min_value:0,max_value:100,default_value:0}}},{tab_title:"Radius",contents:{video_boder_radius:{type:"box_model",model_type:"border_radius",min_value:0,max_value:100,allow_type:!0}}},{tab_title:"Padding",contents:{video_padding:{type:"box_model",model_type:"padding",allow_type:!0,min_value:0,max_value:100}}},{tab_title:"Margin",contents:{video_margin:{type:"box_model",model_type:"margin",allow_type:!0,min_value:0,max_value:100}}}]}},definitions:{type:"section",custom_id:{type:"text_field",title:"ID",default_value:"ID"},custom_classes:{type:"text_field",title:"Classes",default_value:""},custom_attributes:{type:"custom_attributes"},animations:{type:"animations"}}}}}),e(document).ready(function(){AWEContent.Controllers.video=new AWEContent.Views.VideoItemController,AWEContent.Panels.video=new AWEContent.Views.VideoPanel})}(jQuery);