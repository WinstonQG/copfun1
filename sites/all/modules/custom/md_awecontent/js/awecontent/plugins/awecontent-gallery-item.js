!function(e){"use strict";AWEContent.Models.Image=Backbone.RelationalModel.extend({defaults:{fid:-1,srcThumbStyle:"",srcImageStyle:"",linkImage:"",captionImage:"",targetImage:1,enableCaption:0,enableLightBox:1,captionPosition:"top",boxModelSettings:{}},relations:[{type:Backbone.HasOne,key:"boxModelSettings",relatedModel:AWEContent.Models.BoxModelSettings}],createView:function(){this.view=new AWEContent.Views.Image({model:this})},getView:function(){return this.view},clone:function(){var t={};return e.each(this.toJSON(),function(e,a){t[e]=a}),t.boxModelSettings=new AWEContent.Models.BoxModelSettings(t.boxModelSettings),new AWEContent.Models.Image(t)}}),AWEContent.Views.Image=Backbone.View.extend({tagName:"li",className:"md-item-image",events:{"click .awe-box-btn":"changeContent","click .edit-link":"editLink","click .edit-caption":"editCaption","click .remove-image":"destroyImage"},template:_.template('<div class="awe-image-item">                <a class="mgf-md-popup <%= enableLightBox %>" target="<%= targetImage %>" href="<%= extendImage %>">                    <div class="awe-image-content">                        <% if (captionPos == "over" || captionPos == "top") { %>                        <div class="awe-image-caption"><%= captionImage %></div>                        <% } %>                        <div class="awe-image-container"><img src="<%= srcImage %>" alt=""></div>                        <% if (captionPos == "bottom") { %>                        <div class="awe-image-caption"><%= captionImage %></div>                        <% } %>                    </div>                </a>                <div class="awe-image-control">                    <ul>                        <li class="edit-link"<% if (enableLightBox) { %> style="display: none;" <% } %>>                            <i class="ic ac-icon-link"></i>                            <div class="awe-control-box">                                <div class="awe-box-header">Image link</div>                                <div class="awe-box-content">                                    <div class="awe-box-item">                                        <textarea></textarea>                                    </div>                                    <div class="awe-box-item">                                        <input type="checkbox" name="target" id="ckb-target" class="ckb-target">                                        <label for="ckb-target" class="label-checkbox">Open new window</label>                                    </div>                                </div>                                <div class="awe-box-footer">                                    <a href="#" class="awe-box-btn js-ok">Save</a>                                    <a href="#" class="awe-box-btn js-cancel">Cancel</a>                                </div>                            </div>                        </li>                        <li class="edit-caption"<% if (!enableCaption) { %> style="display: none;" <% } %>>                            <i class="ic ac-icon-caption"></i>                            <div class="awe-control-box">                                <div class="awe-box-header">Image caption</div>                                 <div class="awe-box-content">                                    <div class="awe-box-item">                                        <textarea></textarea>                                    </div>                                </div>                                <div class="awe-box-footer">                                    <a href="#" class="awe-box-btn js-ok">Save</a>                                    <a href="#" class="awe-box-btn js-cancel">Cancel</a>                                </div>                            </div>                        </li>                        <li class="remove-image"><i class="ic ac-icon-trash"></i></li>                    </ul>                </div>            </div>'),initialize:function(){this.listenTo(this.model,"change",this.changeSettings),this.listenTo(this.model.get("boxModelSettings"),"change",this.changeSettings),this.render(),this.$el.delegate(".awe-control-box","click",function(e){e.stopPropagation()})},render:function(){var t=this,a=t.model.toJSON(),i=a.srcThumbStyle,l=a.srcImageStyle,o=a.linkImage?a.linkImage:"javascript:void(0)",n=a.captionImage,s=a.targetImage?"_blank":"_self",g=a.enableLightBox?"open-lightbox":"",m=a.enableLightBox?l:o;return""==a.linkImage&&(s="_self"),t.$el.append(t.template({srcImage:i,captionImage:n,enableLightBox:g,enableCaption:a.enableCaption,targetImage:s,extendImage:m,captionPos:a.captionPosition})),t.$img=e("img",t.el),t.$mgfPopup=e(".mgf-md-popup",t.el),"over"==a.captionPosition&&t.$el.addClass("position-over"),e(".awe-image-content",t.el).renderItemDefaultBoxModel(a.boxModelSettings),setTimeout(function(){t.resizeImage()},50),t.$el},resizeImage:function(){this.$img.css({width:"",height:""});var e=this.$img.width(),t=this.$img.height(),a=.75;t/e>a?(e="100%",t="auto"):(e="auto",t="100%"),this.$img.css({width:e,height:t})},changeSettings:function(t){var a=this,i=a.model.toJSON(),l=e(".mgf-md-popup",a.el),o=e(".awe-image-caption",a.el),n=e(".awe-image-content",a.el);e.each(t.changedAttributes(),function(s,g){switch(s){case"srcThumbStyle":a.$img.attr("src",g),a.$img.load(function(){a.resizeImage()});break;case"srcImageStyle":i.enableLightBox&&a.$mgfPopup.attr("href",g);break;case"linkImage":i.enableLightBox||a.$mgfPopup.attr("href",g);break;case"captionImage":o.html(g),a.setMaxHeight(a.$el.index());break;case"targetImage":var m=g?"_blank":"_self";l.attr("target",m);break;case"enableLightBox":if(g)a.$mgfPopup.addClass("open-lightbox").attr("href",i.srcImageStyle);else{var r=i.linkImage?i.linkImage:"javascript:void(0)";a.$mgfPopup.removeClass("open-lightbox").attr("href",r).attr("target","_self")}break;case"captionPosition":switch(a.$el.removeClass("position-over"),g){case"top":n.prepend(o);break;case"bottom":n.append(o);break;case"over":a.$el.addClass("position-over")}break;default:e(".awe-image-content",a.el).renderChangeSettingBoxModel(s,g,t)}})},changeContent:function(t){t.preventDefault(),t.stopPropagation();var a=this,i=e(t.target),l=i.closest("li.active"),o=e("textarea",l).val();if(l.removeClass("active"),i.hasClass("js-ok"))if(l.hasClass("edit-link")){var n=e(".ckb-target",l).prop("checked");a.model.set("linkImage",o),a.model.set("targetImage",n?1:0)}else l.hasClass("edit-caption")&&a.model.set("captionImage",o)},editLink:function(t){var a=this,i=a.model.get("linkImage"),l=e(t.target).hasClass("edit-link")?e(t.target):e(t.target).closest(".edit-link"),o=e("textarea",l);l.siblings("li").removeClass("active"),l.toggleClass("active"),o.val(i).parent().css("z-index",999)},editCaption:function(t){var a=this,i=a.model.get("captionImage"),l=e(t.target).hasClass("edit-caption")?e(t.target):e(t.target).closest(".edit-caption"),o=e("textarea",l);l.siblings("li").removeClass("active"),l.toggleClass("active"),o.val(i).parent().css("z-index",999)},destroyImage:function(){this.model.destroy(),this.$el.remove()},setMaxHeight:function(t){if(void 0!=t){var a=this.model.get("columns"),i=Math.floor(t/a-1),l=e("li.md-item-image",this.$el.parent()).slice(i,a),o=0;e(".awe-image-caption",l).css("height",""),l.each(function(){var t=e(".awe-image-caption",this).height();t>o&&(o=t)}),o>0&&e(".awe-image-caption",l).height(o)}}}),AWEContent.Collections.ListImage=Backbone.Collection.extend({model:AWEContent.Models.Image}),AWEContent.Views.ListImage=Backbone.View.extend({tagName:"ul",className:"list-gallery clearfix",events:{},initialize:function(){this.listenTo(this.collection,"add",this.addImage),this.listenTo(this.collection,"destroy",this.removeImage),this.render()},render:function(){var e=this;e.collection.each(function(t){t.createView(),e.$el.append(t.getView().$el)})},addImage:function(e){e.createView(),this.$el.append(e.getView().$el)}}),AWEContent.Models.GalleryItem=AWEContent.Models.Item.extend({defaults:{machine_name:"gallery",images:[],columns:5,customColumnsResponsive:0,smallDesktopColumns:4,tabletColumns:3,mobileColumns:1,styleImage:"none",enableLightBox:1,enableThumbnail:1,styleThumb:"none",enableCaption:1,captionColor:"",captionPosition:"over",captionOnHover:0,imageBgOverlay:"",captionOnLightBox:1,boxModelSettings:{},imageBoxModelSettings:{},customID:"",customClass:"",customEnableAttributes:0,customDataAttributes:"[]",customActionAttributes:'{"newAction": "", "newAttrName": "", "newAttrValue": ""}',customEnableAnimations:1,customDataAnimations:'{"type" : "none"}',lgResponsive:!0,xsResponsive:!0,mediumResponsive:!0,smResponsive:!0,itemsThumb:5},relations:[{type:Backbone.HasOne,key:"boxModelSettings",relatedModel:AWEContent.Models.BoxModelSettings},{type:Backbone.HasOne,key:"imageBoxModelSettings",relatedModel:AWEContent.Models.BoxModelSettings},{type:Backbone.HasMany,key:"images",relatedModel:AWEContent.Models.Image,relatedCollection:AWEContent.Collections.ListImage}],createView:function(){this.view=new AWEContent.Views.GalleryItem({model:this})},clone:function(){var t={},a=new AWEContent.Collections.ListImage;return this.get("images").each(function(e){a.add(e.clone())}),e.each(this.toJSON(),function(e,a){"images"!=e&&(t[e]=a)}),t.images=a,t.boxModelSettings=new AWEContent.Models.BoxModelSettings(t.boxModelSettings),t.imageBoxModelSettings=new AWEContent.Models.BoxModelSettings(t.imageBoxModelSettings),new AWEContent.Models.GalleryItem(t)}}),AWEContent.Views.GalleryItem=AWEContent.Views.Item.extend({refreshGidImage:function(){AWEContent.Panels.gallery.isOpenned&&AWEContent.Panels.gallery.setPanelElementsValue(!0)},initialize:function(){AWEContent.Views.Item.prototype.initialize.call(this),this.listenTo(this.model.get("boxModelSettings"),"change",this.applySettingsChanged),this.listenTo(this.model.get("imageBoxModelSettings"),"change",this.applySettingsChangedImageStyle),this.listenTo(this.model.get("images"),"remove",this.refreshGidImage),this.listenTo(this.model.get("images"),"add",this.addImage)},applySettingsChangedImageStyle:function(t){var a=this;e.each(t.changedAttributes(),function(e,t){a.model.get("images").each(function(a){a.get("boxModelSettings").set(e,t)})})},renderItemContent:function(){function t(){AWEContent.jqIframe(o).magnificPopup({delegate:".open-lightbox",type:"image",removalDelay:300,prependTo:".awe-page-wrapper",mainClass:"mfp-fade",callbacks:{open:function(){var t=s(".mfp-container"),i=s(".mfp-content",t),l=s('<div class="mdf-list-thumb"><div class="thumb-content"><div class="thumb-control"></div></div></div>'),o=s(".thumb-content",l),n=s(".thumb-control",l),g=s(".mgf-md-popup img",a.el),m=a.model.get("itemsThumb"),r=this.ev.attr("data-enable-thumb");n.append('<i class="ic ac-icon-arrow-left gallery-prev"></i><i class="ic ac-icon-arrow-right gallery-next"></i><input type="hidden" class="gallery-trigger"/>'),t.next(".mdf-list-thumb").length||"true"!=r||(s.each(g,function(t,a){var i=e('<img src=""/>').attr("src",e(a).attr("src"));s(".thumb-content",l).append(i)}),i.after(l),o.click(function(e){e.stopPropagation()}),o.change(function(e,t){if(void 0!=t&&"number"==typeof t.index){var a=t.index;s("img",o).removeClass("img-show"),s("img",o).eq(a).addClass("active");for(var i=0;m>i;i++){var l=a+i;s("img",o).eq(l).addClass("img-show")}var n=s("img.img-show",o).length;if(m>n)for(i=0;m-n>i;i++)l=a-1-i,s("img",o).eq(l).addClass("img-show")}}),s("img",o).click(function(){var e=s(this).index()-1;s(this).addClass("active"),s(this).siblings("img").removeClass("active"),s.magnificPopup.instance.goTo(e)}),s(".gallery-trigger",t).change(function(e,t){if(e.stopPropagation(),void 0!=t&&"number"==typeof t.index){var a=t.index,i=s("img",o).eq(a);i.addClass("active"),i.siblings("img").removeClass("active"),i.hasClass("img-show")||o.trigger("change",{index:a})}}),s(".gallery-next",n).click(function(){if(s(".img-show:last",o).index()==s("img",o).length)s(".gallery-trigger",t).trigger("change",{index:0,isNav:!0}),s("img.active",o).removeClass("active");else{var e=s("img.img-show:last",o).index();s("img.img-show",o).removeClass("img-show");for(var a=0;m>a;a++){var i=e+a;s("img",o).eq(i).addClass("img-show")}if(s(".img-show",o).length<m){var l=s(".img-show",o).length,n=s(".img-show:first",o).index()-1;for(a=0;m-l>a;a++){var g=n-a-1;s("img",o).eq(g).addClass("img-show")}}}}),s(".gallery-prev",n).click(function(){if(1==s(".img-show:first",o).index()){var a=e("img",o).length-m;s(".gallery-trigger",t).trigger("change",{index:a,isNav:!0}),s("img.active",o).removeClass("active")}else{var i=s("img.img-show:first",o).index()-2;s("img.img-show",o).removeClass("img-show");for(var l=0;m>l;l++){var n=i-l;(n>=0||n<=s("img",o)-1)&&s("img",o).eq(n).addClass("img-show")}if(s(".img-show",o).length<m){var g=s(".img-show",o).length,r=s(".img-show:last",o).index()-1;for(l=0;m-g>l;l++){var c=r+l+1;s("img",o).eq(c).addClass("img-show")}}}}))},change:function(e){setTimeout(function(){var t=s(".mfp-container"),i=s(".thumb-content",t);a.isOpenThumb||(a.isOpenThumb=!0,i.trigger("change",{index:e.index})),s(".gallery-trigger",t).trigger("change",{index:e.index})},50)},markupParse:function(t,a,i){var l=e(".awe-image-caption",i.el).html(),o=e(".awe-image-caption",i.el).css("color"),n=this.ev.attr("data-caption-on-lightbox");a.description=n&&"true"==n?e("<div />").html(l).css("color",o):""},close:function(){a.isOpenThumb=!1}},gallery:{enabled:!0},image:{headerFit:!0,captionFit:!0,preserveHeaderAndCaptionWidth:!1,markup:'<div class="mfp-figure">                                <div class="mfp-img"></div>                                <div class="mfp-description"></div>                                <div class="mfp-counter"></div>                            </div>'}})}var a=this,i=a.model.toJSON(),l=a.model.get("images"),o=e('<div class="awe-item awe-gallery"></div>'),n=new AWEContent.Views.ListImage({collection:l});AWEContent.Library.addLibrary("magnific",function(){t()}),o.append(n.$el),o.addClass("image-col-"+i.columns),i.customColumnsResponsive&&o.addClass("image-col-md-"+i.smallDesktopColumns+" image-col-sm-"+i.tabletColumns+" image-col-xs-"+i.mobileColumns),l.each(function(e){i.enableLightBox?e.set("enableLightBox",1):e.set("enableLightBox",0),i.enableCaption||i.enableLightBox&&i.captionOnLightBox?e.set("enableCaption",1):e.set("enableCaption",0),e.set("captionPosition",i.captionPosition)}),o.attr("data-enable-thumb",i.enableThumbnail?!0:!1),o.attr("data-caption-on-lightbox",i.captionOnLightBox?!0:!1),i.enableCaption||o.addClass("disable-caption"),"over"==i.captionPosition&&(e("li .awe-image-content",o).prepend('<div class="awe-image-overlay"></div>'),e("li .awe-image-content > .awe-image-overlay",o).css("background-color",i.imageBgOverlay),i.captionOnHover&&o.addClass("caption-hover")),o.attr("id",i.customID).addClass(i.customClass).renderItemDefaultBoxModel(i.boxModelSettings),o.renderItemDefaultAttributes(i.customEnableAttributes,i.customDataAttributes),i.customEnableAnimations&&o.processAnimations(i.customDataAnimations),a.$el.defaultResponsive(i),e(".awe-image-caption",o).css("color",i.captionColor);var s=AWEContent.jqIframe;a.isOpenThumb=!1;var g=setInterval(function(){if(AWEContent.contentIframe.find(".md-item-image").length>0){clearInterval(g);var t=0,i=0;AWEContent.jqIframe(".list-gallery").sortable({items:" > li",revert:!0,forcePlaceholderSize:!0,start:function(i,l){e(".js-edit-item",a.$el).trigger("click"),t=l.item.index()},stop:function(e,l){if(i=l.item.index(),i!=t){var o=a.model.get("images").remove(a.model.get("images").at(t),{silent:!0});a.model.get("images").add(o,{at:i,silent:!0}),AWEContent.Panels.gallery.setPanelElementsValue(!0),a.refreshGidImage(),a.setItemHeight()}}}),setTimeout(function(){a.resizeItem(),a.setItemHeight()},50)}},50);return o.aweDragUpload({multiUpload:!0,uploadSuccessCallback:function(t){if(t.status&&t.file){var i=a.model.get("images"),l=a.model.get("styleImage"),o=a.model.get("styleThumb"),n=l+","+o,s=t.file;e.post(AWEContent.Path.imageStyleURL,{fids:""+s.fid,styles:n},function(t){if("string"==e.type(t)&&(t=JSON.parse(t.trim())),1==a.model.get("createFromDefault"))a.model.get("images").at(0).set({fid:s.fid,srcThumbStyle:t[s.fid][a.model.get("styleThumb")],srcImageStyle:t[s.fid][a.model.get("styleImage")],enableCaption:a.model.get("enableCaption")||a.model.get("enableLightBox")&&a.model.get("captionOnLightBox")}),a.model.set("createFromDefault",!1);else{var l=new AWEContent.Models.Image({fid:s.fid,srcThumbStyle:t[s.fid][a.model.get("styleThumb")],srcImageStyle:t[s.fid][a.model.get("styleImage")],captionPosition:a.model.get("captionPosition"),enableLightBox:a.model.get("enableLightBox"),enableCaption:a.model.get("enableCaption")||a.model.get("enableLightBox")&&a.model.get("captionOnLightBox"),boxModelSettings:new AWEContent.Models.BoxModelSettings(a.model.get("imageBoxModelSettings").toJSON())});i.add(l),a.refreshGidImage()}})}},uploadFinishedCallback:function(){a.resizeItem()}}),o},setItemHeight:function(){var t=e("li.md-item-image",this.$el),a=this.model.get("columns"),i=0,l=t.length;e(".awe-image-caption",t).css("height","");do{var o=t.slice(i,a),n=0;i+=a,o.each(function(){var t=e(".awe-image-caption",this).height();t>n&&(n=t)}),e(".awe-image-caption",o).height(n)}while(l-1>i)},applySettingsChanged:function(t){var a=this,i=a.model.toJSON(),l=a.model.get("images"),o=e(".awe-gallery",a.el),n=a.$el.height();e.each(t.changedAttributes(),function(n,s){switch(a.$el.changeResponsive(n,s),o.renderChangeSettingBoxModel(n,s,t),n){case"columns":var g="image-col-"+a.model.previousAttributes().columns,m="image-col-"+s;o.removeClass(g).addClass(m),a.resizeItem();break;case"customColumnsResponsive":var r="image-col-md-"+i.smallDesktopColumns,c="image-col-sm-"+i.tabletColumns,d="image-col-xs-"+i.mobileColumns;s?o.addClass(r+" "+c+" "+d):o.removeClass(r+" "+c+" "+d);break;case"smallDesktopColumns":var u="image-col-md-"+a.model.previousAttributes()[n];o.removeClass(u).addClass("image-col-md-"+s);break;case"tabletColumns":var u="image-col-sm-"+a.model.previousAttributes()[n];o.removeClass(u).addClass("image-col-sm-"+s);break;case"mobileColumns":var u="image-col-xs-"+a.model.previousAttributes()[n];o.removeClass(u).addClass("image-col-xs-"+s);break;case"styleImage":case"styleThumb":var h=i.styleImage,p=i.styleThumb,b=h+","+p,v=[];e.each(l.toJSON(),function(){v.push(this.fid)}),v.length&&e.post(AWEContent.Path.imageStyleURL,{fids:v.join(","),styles:b},function(t){"string"==e.type(t)&&(t=JSON.parse(t.trim())),l.each(function(e){t[e.get("fid")]&&e.set({srcThumbStyle:t[e.get("fid")][i.styleThumb],srcImageStyle:t[e.get("fid")][i.styleImage]})})});break;case"enableLightBox":l.each(function(e){e.set("enableLightBox",s)}),s&&i.captionOnLightBox||i.enableCaption?e(".edit-caption",o).show():e(".edit-caption",o).hide();break;case"enableThumbnail":o.attr("data-enable-thumb",s?!0:!1);break;case"enableCaption":s?(o.removeClass("disable-caption"),e(".edit-caption",o).show()):(o.addClass("disable-caption"),i.enableLightBox&&i.captionOnLightBox||e(".edit-caption",o).hide());break;case"captionPosition":l.each(function(e){e.set("captionPosition",s)}),"over"!=s?(o.removeClass("caption-hover"),e("li .awe-image-content > .awe-image-overlay",o).remove()):(i.captionOnHover&&o.addClass("caption-hover"),e("li .awe-image-content",o).prepend('<div class="awe-image-overlay"></div>'),e("li .awe-image-content > .awe-image-overlay",o).css("background-color",i.imageBgOverlay),e("li .awe-image-content > .awe-image-overlay",o).click(function(){e(".mgf-md-popup",e(this).parent()).trigger("click")}));break;case"captionColor":e(".awe-image-caption",o).css("color",s);break;case"captionOnHover":s&&"over"==i.captionPosition?o.addClass("caption-hover"):o.removeClass("caption-hover");break;case"imageBgOverlay":e("li .awe-image-content > .awe-image-overlay",o).css("background-color",s);break;case"captionOnLightBox":o.attr("data-caption-on-lightbox",s?!0:!1),s||i.enableCaption?e(".edit-caption",o).show():e(".edit-caption",o).hide();break;case"customID":o.attr("id",s);break;case"customClass":var y=a.model.previousAttributes().customClass;o.removeClass(y).addClass(s);break;case"customEnableAttributes":o.renderChangeSettingsAttributes(n,s,i.customDataAttributes);break;case"customActionAttributes":o.renderChangeSettingsAttributes(n,s);break;case"customEnableAnimations":var f,C;s?(f=i.customDataAnimations,C=null,o.processAnimations(f)):(f=null,C=i.customDataAnimations,o.processAnimations(f,C));break;case"customDataAnimations":var f=i.customDataAnimations,C=a.model.previousAttributes().customDataAnimations;o.processAnimations(f,C)}}),setTimeout(function(){a.checkChangeHeight(n)},100)},addImage:function(){var t=this,a=e(".awe-gallery",this.el);"over"==this.model.get("captionPosition")&&e(".md-item-image",a).each(function(){0==e(".awe-image-overlay",e(this)).length&&(e(".awe-image-content",e(this)).prepend('<div class="awe-image-overlay"></div>'),e(".awe-image-overlay",e(this)).css("background-color",t.model.get("imageBgOverlay")))})}}),AWEContent.Views.GalleryItemController=AWEContent.Views.ItemController.extend({machineName:"gallery",controllerHtml:function(){return'<div class="title-icon">Gallery</div><i class="ic ac-icon-gallery"></i>'},createItemModel:function(e){var t,a,i;if(void 0!=e)return t=new AWEContent.Models.BoxModelSettings(e.boxModelSettings),a=new AWEContent.Collections.ListImage(e.images),e.boxModelSettings=t,e.images=a,e.createFromDefault=!1,new AWEContent.Models.GalleryItem(e);t=new AWEContent.Models.BoxModelSettings,i=new AWEContent.Models.BoxModelSettings;var l=new AWEContent.Collections.ListImage,o=new AWEContent.Models.GalleryItem({boxModelSettings:t,images:l,imageBoxModelSettings:i,createFromDefault:!0}),n=new AWEContent.Models.Image({srcImageStyle:AWEContent.Path.defaultImage,srcThumbStyle:AWEContent.Path.defaultImage,enableLightBox:o.get("enableLightBox"),enableCaption:o.get("enableCaption")||o.get("enableLightBox")&&o.get("captionOnLightBox")});return o.get("images").add(n),o}}),AWEContent.Views.GalleryPanel=AWEContent.Views.ItemPanel.extend({tagName:"div",className:"awe-obj-panel gallery-panel",panelName:"gallery",initPanel:function(){AWEContent.Views.ItemPanel.prototype.initPanel.call(this);var t=this;t.$el.mousedown(function(){AWEContent.jqIframe(".mfp-close-btn-in").length&&AWEContent.jqIframe(".mfp-close-btn-in").trigger("click")}),e("#gallery-select-image .control-gallery input[name=selected_media]",t.el).change(function(){var a=e.parseJSON(e(this).val().trim()),i='<div class="book-lib"><i class="ic ac-icon-done"></i><img src="" alt="book"><input type="hidden" name="selected_media"/></div>';if("object"==typeof a){var l=e("#gallery-select-image .library",t.el),o=t.editingModel.get("styleImage"),n=t.editingModel.get("styleThumb"),s=o+","+n,g=[];e.each(a,function(){g.push(this.fid)}),""!=AWEContent.Path.imageStyleURL?e.post(AWEContent.Path.imageStyleURL,{fids:g.join(","),styles:s},function(o){if("string"==e.type(o))try{o=JSON.parse(o)}catch(n){}"object"==typeof o&&e.each(a,function(){var a=this;if(!t.editingModel.get("images").length&&t.editingModel.get("createFromDefault")&&t.editingModel.set("createFromDefault",!1),t.editingModel.get("createFromDefault"))t.editingModel.set("createFromDefault",!1),t.editingModel.get("images").at(0).set({fid:a.fid,srcThumbStyle:o[a.fid][t.editingModel.get("styleThumb")],srcImageStyle:o[a.fid][t.editingModel.get("styleImage")]}),e("img",l).eq(0).attr("src",a.file_url);else{var n=new AWEContent.Models.Image({fid:a.fid,srcThumbStyle:o[a.fid][t.editingModel.get("styleThumb")],srcImageStyle:o[a.fid][t.editingModel.get("styleImage")],captionPosition:t.editingModel.get("captionPosition"),enableLightBox:t.editingModel.get("enableLightBox"),enableCaption:t.editingModel.get("enableLightBox")&&t.editingModel.get("captionOnLightBox")||t.editingModel.get("enableCaption"),boxModelSettings:new AWEContent.Models.BoxModelSettings(t.editingModel.get("imageBoxModelSettings").toJSON())}),s=e(i);e("img",s).attr("src",a.file_url),l.append(s),t.editingModel.get("images").add(n)}})}):e.each(a,function(){var a=this;if(!t.editingModel.get("images").length&&t.editingModel.get("createFromDefault")&&t.editingModel.set("createFromDefault",!1),t.editingModel.get("createFromDefault"))t.editingModel.set("createFromDefault",!1),t.editingModel.get("images").at(0).set({srcThumbStyle:a.file_url,srcImageStyle:a.file_url,fid:a.fid}),e("img",l).eq(0).attr("src",a.file_url);else{var o=new AWEContent.Models.Image({fid:a.fid,srcThumbStyle:a.file_url,srcImageStyle:a.file_url,enableCaption:t.editingModel.get("enableLightBox")&&t.editingModel.get("captionOnLightBox")||t.editingModel.get("enableCaption"),enableLightBox:t.editingModel.get("enableLightBox"),boxModelSettings:new AWEContent.Models.BoxModelSettings(t.editingModel.get("imageBoxModelSettings").toJSON())}),n=e(i);e("img",n).attr("src",a.file_url),l.append(n),t.editingModel.get("images").add(o),o.set("captionPosition",t.editingModel.get("captionPosition")),o.set("enableLightBox",t.editingModel.get("enableLightBox"))}})}}),e("#gallery-select-image",t.el).delegate(".book-lib input[name=selected_media]","change",function(){var a=e(this).closest(".book-lib"),i=a.index(),l=t.editingModel.get("images").at(i),o=t.editingModel.get("styleImage"),n=t.editingModel.get("styleThumb"),s=o+","+n,g=e.parseJSON(e(this).val().trim());g&&(""!=AWEContent.Path.imageStyleURL?e.post(AWEContent.Path.imageStyleURL,{fids:""+g.fid,styles:s},function(e){l.set({fid:g.fid,srcThumbStyle:e[g.fid][t.editingModel.get("styleThumb")],srcImageStyle:e[g.fid][t.editingModel.get("styleImage")]})}):l.set({fid:g.fid,srcThumbStyle:g.file_url,srcImageStyle:g.file_url}),e("img",a).attr("src",g.file_url),t.editingModel.get("createFromDefault")&&t.editingModel.set("createFromDefault",!1))}),e("#gallery-column",this.el).change(function(e,a){t.editingModel.set("columns",a.value)}),""!=AWEContent.Path.imageStyleURL&&(e("#gallery-style-image",this.el).change(function(e,a){t.editingModel.set("styleImage",a.value)}),e("#gallery-style-thumbnail",this.el).change(function(e,a){t.editingModel.set("styleThumb",a.value)})),e("#gallery-custom-column-responsive input[name=toggle_value]",this.el).change(function(a,i){var l=parseInt(e(this).val());i||t.editingModel.set("customColumnsResponsive",l),e("#gallery-columns-desktop-small, #gallery-columns-tablet, #gallery-columns-mobile",t.el).hide(),l&&e("#gallery-columns-desktop-small, #gallery-columns-tablet, #gallery-columns-mobile",t.el).show()}),e("#gallery-columns-desktop-small",t.$el).change(function(e,a){t.editingModel.set("smallDesktopColumns",a.value)}),e("#gallery-columns-tablet",t.$el).change(function(e,a){t.editingModel.set("tabletColumns",a.value)}),e("#gallery-columns-mobile",t.$el).change(function(e,a){t.editingModel.set("mobileColumns",a.value)}),e("#gallery-enable-lightbox input[name=toggle_value]",this.el).change(function(a,i){var l=parseInt(e(this).val());i||t.editingModel.set("enableLightBox",l),e("#gallery-enable-thumbnail, #gallery-number-thumbnail, #gallery-on-lightbox, #gallery-style-image, .lightbox-style-title",t.el).hide(),l&&(e("#gallery-enable-thumbnail, #gallery-style-image, #gallery-on-lightbox, .lightbox-style-title",t.el).show(),e("#gallery-enable-thumbnail input[name=toggle_value]",t.el).trigger("change",{isPanel:!0})),e("#gallery-caption-color",t.el).hide(),(l&&t.editingModel.get("captionOnLightBox")||t.editingModel.get("enableCaption"))&&e("#gallery-caption-color",t.el).show()}),e("#gallery-enable-thumbnail input[name=toggle_value]",this.el).change(function(a,i){parseInt(e(this).val())?e("#gallery-number-thumbnail",t.el).show():e("#gallery-number-thumbnail",t.el).hide(),i||t.editingModel.set("enableThumbnail",parseInt(e(this).val()))}),e("#gallery-number-thumbnail",this.el).change(function(e,a){t.editingModel.set("itemsThumb",a.value)}),e("#gallery-enable-caption input[name=toggle_value]",this.el).change(function(a,i){var l=parseInt(e(this).val());i||t.editingModel.set("enableCaption",l),e("#gallery-position, #gallery-on-hover, #gallery-image-bg-overlay",t.el).hide(),e("#gallery-caption-color",t.$el).show(),l?(e("#gallery-position",t.el).show(),"over"==t.editingModel.get("captionPosition")&&e("#gallery-on-hover, #gallery-image-bg-overlay",t.$el).show()):t.editingModel.get("enableLightBox")&&t.editingModel.get("captionOnLightBox")||e("#gallery-caption-color",t.$el).hide()}),e("#gallery-position",this.el).change(function(a,i){t.editingModel.set("captionPosition",i.value),e("#gallery-on-hover, #gallery-image-bg-overlay").hide(),"over"==i.value&&t.editingModel.get("enableCaption")&&e("#gallery-on-hover, #gallery-image-bg-overlay").show()}),e("#gallery-caption-color",this.el).change(function(e,a){a=a?a.toRgbString():"",t.editingModel.set("captionColor",a)}),e("#gallery-on-hover input[name=toggle_value]",this.el).change(function(a,i){i||t.editingModel.set("captionOnHover",parseInt(e(this).val()))}),e("#gallery-image-bg-overlay",this.el).change(function(e,a){a=a?a.toRgbString():"",t.editingModel.set("imageBgOverlay",a)}),e("#gallery-on-lightbox input[name=toggle_value]",this.el).change(function(a,i){var l=parseInt(e(this).val());i||t.editingModel.set("captionOnLightBox",l),e("#gallery-caption-color",t.$el).show(),l||t.editingModel.get("enableCaption")||e("#gallery-caption-color",t.$el).hide()}),e("#gallery-layout-tab",this.el).initBoxModelPanel(this,"boxModelSettings"),e("#gallery-image-layout-tab",this.el).initBoxModelPanel(this,"imageBoxModelSettings"),e("#text-gallery-custom-id",this.el).change(function(){t.editingModel.set("customID",e(this).val())}),e("#text-gallery-custom-classes",this.el).change(function(){t.editingModel.set("customClass",e(this).val())}),e("#gallery-custom-attributes",this.el).initAttributesPanel(t),e("#gallery-animations input[name=enabled_custom_animation]",this.el).change(function(a,i){t.editingModel.set("customEnableAnimations",parseInt(e(this).val())),i&&t.editingModel.set("customDataAnimations",JSON.stringify(i.animations))})},setPanelElementsValue:function(t){var a=this,i=this.editingModel.toJSON(),l='<div class="book-lib"><i class="ic ac-icon-done"></i><img src="" alt="book"><input type="hidden" name="selected_media"/></div>',o=e("#gallery-select-image .library",a.el);o.empty(),e.each(i.images,function(t,a){var i=e(l);e("img",i).attr("src",a.srcThumbStyle),o.append(i)}),t||(e("#gallery-column",this.el).aweSlider("value",i.columns),e("#gallery-custom-column-responsive input[name=toggle_value]",a.el).val(i.customColumnsResponsive).trigger("change",!0),e("#gallery-columns-desktop-small",this.el).aweSlider("value",i.smallDesktopColumns),e("#gallery-columns-tablet",this.el).aweSlider("value",i.tabletColumns),e("#gallery-columns-mobile",this.el).aweSlider("value",i.mobileColumns),""!=AWEContent.Path.imageStyleURL?(e("#gallery-style-image",a.el).aweSelect("value",i.styleImage),e("#gallery-style-thumbnail",a.el).aweSelect("value",i.styleThumb)):e("#gallery-style-image, #gallery-style-thumbnail",a.el).hide(),e("#gallery-enable-thumbnail input[name=toggle_value]",a.el).val(i.enableThumbnail).trigger("change",!0),e("#gallery-enable-lightbox input[name=toggle_value]",a.el).val(i.enableLightBox).trigger("change",!0),e("#gallery-enable-caption input[name=toggle_value]",a.el).val(i.enableCaption).trigger("change",!0),e("#gallery-position",a.el).aweSelect("value",i.captionPosition),e("#gallery-caption-color",a.el).aweColorPicker("value",i.captionColor),e("#gallery-on-hover input[name=toggle_value]",a.el).val(i.captionOnHover).trigger("change",!0),e("#gallery-image-bg-overlay",a.el).aweColorPicker("value",i.imageBgOverlay),e("#gallery-on-lightbox input[name=toggle_value]",a.el).val(i.captionOnLightBox).trigger("change",!0),e("#gallery-layout-tab",a.el).initBoxModel(i.boxModelSettings),e("#gallery-image-layout-tab",a.el).initBoxModel(i.imageBoxModelSettings),e("#text-gallery-custom-id",a.el).val(i.customID),e("#text-gallery-custom-classes",a.el).val(i.customClass),e("#gallery-custom-attributes",a.el).initAttributes(i.customEnableAttributes,i.customDataAttributes),e("#gallery-animations input[name=enabled_custom_animation]",a.el).val(i.customEnableAnimations).trigger("change"),e("#gallery-animations input[name=enabled_custom_animation]",a.el).attr("data-animations",i.customDataAnimations).data("view",this.editingModel.view))
},buildPanel:function(){return{title:{type:"markup",markup:'<div class="awe-title"><h2>Gallery</h2></div>'},custom_style:{type:"section",select_image:{type:"gallery",title:"Add Images",columns:4},column:{type:"slider",title:"Column",values:[1,2,3,4,5,6,7,8,9,10,11,12],default_value:4,allow_type:!0},custom_column_responsive:{type:"toggle",title:"Custom Responsive",default_value:0},columns_desktop_small:{type:"slider",title:"Desktop Small",values:[1,2,3,4,5,6],default_value:4,allow_type:!0},columns_tablet:{type:"slider",title:"Tablet",values:[1,2,3,4,5,6],default_value:4,allow_type:!0},columns_mobile:{type:"slider",title:"Mobile",values:[1,2,3,4,5,6],default_value:4,allow_type:!0},style_thumbnail:{title:"Thumbnail Image Style",type:"image_style_list",default_value:"image-style",attributes:{"class":["long-title"]}},enable_lightbox:{type:"toggle",title:"Enable Lightbox",default_value:0},style_image:{title:"LightBox Image Style",type:"image_style_list",default_value:"image-style",attributes:{"class":["long-title"]}}},custom_caption:{type:"section",enable_caption:{type:"toggle",title:"Caption",default_value:0},caption_color:{type:"colorpicker",title:"Caption Text Color",options:{preferredFormat:"rgb",AlphaVerticle:!0,showAlpha:!0,allowEmpty:!0,showInput:!0}},position:{type:"select",title:"Position",options:{top:"Top",bottom:"Bottom",over:"Over"},default_value:"top"},on_hover:{type:"toggle",title:"Display on hover",default_value:0},image_bg_overlay:{type:"colorpicker",title:"ImageBgOverlay",options:{preferredFormat:"rgb",AlphaVerticle:!0,showAlpha:!0,allowEmpty:!0,showInput:!0}},on_lightbox:{type:"toggle",title:"Caption on lightbox",default_value:0}},image_title:{type:"markup",markup:'<div class="awe-title"><h4>Image Settings</h4></div>'},image_box_settings:{type:"section",image_layout_tab:{type:"tabs",tabs:[{tab_title:"Border",contents:{image_border:{type:"box_border",min_value:0,max_value:100,default_value:0}}},{tab_title:"Radius",contents:{image_boder_radius:{type:"box_model",model_type:"border_radius",min_value:0,max_value:100,allow_type:!0}}},{tab_title:"Padding",contents:{image_padding:{type:"box_model",model_type:"padding",allow_type:!0,min_value:0,max_value:100}}},{tab_title:"Margin",contents:{image_margin:{type:"box_model",model_type:"margin",allow_type:!0,min_value:0,max_value:100}}}]}},box_settings:{type:"section",layout_tab:{type:"tabs",tabs:[{tab_title:"Border",contents:{header_border:{type:"box_border",min_value:0,max_value:100,default_value:0}}},{tab_title:"Radius",contents:{header_boder_radius:{type:"box_model",model_type:"border_radius",min_value:0,max_value:100,allow_type:!0}}},{tab_title:"Padding",contents:{header_padding:{type:"box_model",model_type:"padding",allow_type:!0,min_value:0,max_value:100}}},{tab_title:"Margin",contents:{header_margin:{type:"box_model",model_type:"margin",allow_type:!0,min_value:0,max_value:100}}}]}},definitions:{type:"section",custom_id:{type:"text_field",title:"ID",default_value:""},custom_classes:{type:"text_field",title:"Class",default_value:""},custom_attributes:{type:"custom_attributes"},animations:{type:"animations"}}}}}),e(document).ready(function(){AWEContent.Controllers.gallery=new AWEContent.Views.GalleryItemController,AWEContent.Panels.gallery=new AWEContent.Views.GalleryPanel})}(jQuery);