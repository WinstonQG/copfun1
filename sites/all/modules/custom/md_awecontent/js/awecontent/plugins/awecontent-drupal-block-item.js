!function(e){"use strict";AWEContent.Models.DrupalBlockItem=AWEContent.Models.Item.extend({defaults:{machine_name:"drupal_block",module:"",delta:"",info:"",customTitle:"",customID:"",customClass:"",boxModelSettings:{},enableAnimation:0,animationData:'{"type": "none"}',lgResponsive:!0,xsResponsive:!0,mediumResponsive:!0,smResponsive:!0},relations:[{type:Backbone.HasOne,key:"boxModelSettings",relatedModel:AWEContent.Models.BoxModelSettings}],createView:function(){this.view=new AWEContent.Views.DrupalBlockItem({model:this})},removePanelView:function(){var e=this.get("module")+"-"+this.get("delta");AWEContent.Toolbars.drupal.showController(e),AWEContent.Models.Item.prototype.removePanelView.call(this)}}),AWEContent.Views.DrupalBlockController=AWEContent.Views.ItemController.extend({machineName:"drupal_block",el:"li.ac-dp-block",existingElement:!0,createItemModel:function(t){if(t){var l=t.module+"-"+t.delta,n=e.inArray(l,AWEContent.Toolbars.loadedElements);return n>-1&&(t.delta="invisible",t.module="undefined"),new AWEContent.Models.DrupalBlockItem(t)}return null}}),AWEContent.Views.DrupalBlockItem=AWEContent.Views.Item.extend({initialize:function(){AWEContent.Views.Item.prototype.initialize.call(this),this.listenTo(this.model.get("boxModelSettings"),"change",this.applySettingsChanged)},renderItemContent:function(){var e=this,t=this.model.toJSON();e.$el.addClass("awe-drupal-block-item"),"undefined"!=e.model.get("module")?e.loadBlockContent():(e.$el.prepend('<div class="block-content-unload">This block is used in another place on this page.</div>'),e.$el.addClass("awe-item-unload")),t.xsResponsive||this.$el.addClass("xs-hidden"),t.smResponsive||this.$el.addClass("sm-hidden"),t.mediumResponsive||this.$el.addClass("md-hidden"),this.$el.defaultResponsive(t)},loadBlockContent:function(){var t=this;e("> .block",t.el).remove(),t.$el.prepend('<div class="awe-item-preload"></div>'),e.post(AWEContent.Path.drupalElementURL,{type:this.model.get("machine_name"),module:this.model.get("module"),delta:this.model.get("delta"),custom_title:this.model.get("customTitle")},function(l){if(l.status){var n=t.model.get("module")+"-"+t.model.get("delta"),a=t.model.toJSON();if(t.$el.prepend(l.blockContent),e(".block",t.$el).addClass("awe-item"),a.customID&&e(".block",t.$el).attr("id",a.customID),a.customClass&&e(".block",t.$el).addClass(a.customClass),e(".block",t.$el).renderItemDefaultBoxModel(a.boxModelSettings),a.enableAnimation&&e(".block",t.$el).processAnimations(a.animationData),e(".awe-item-preload",t.$el).remove(),AWEContent.Toolbars.drupal.hideController(n),l.css&&l.css.length&&e.each(l.css,function(){var t="string"==e.type(this)?e('<link type="text/css" rel="stylesheet" href=""/>').attr("href",this):e("<style />").html(this.data);AWEContent.jqIframe("head").append(t)}),l.js&&l.js.length){var o=0,i=0,s=[];if(e.each(l.js,function(){var t=AWEContent.documentIframe.createElement("script");t.setAttribute("type","text/javascript"),"string"==e.type(this)?(t.setAttribute("src",this),i++,t.onload=function(){o++},AWEContent.documentIframe.getElementsByTagName("head")[0].appendChild(t)):(t.innerHTML=this.data,s.push(t))}),s.length)var d=setInterval(function(){o==i&&(clearInterval(d),e.each(s,function(){AWEContent.documentIframe.getElementsByTagName("head")[0].appendChild(this)}))},100)}}})},applySettingsChanged:function(t){var l=this,n=e(".block",l.el);e.each(t.changedAttributes(),function(a,o){switch(l.$el.changeResponsive(a,o),a){case"customTitle":e("> h2",n).length?e("> h2",n).html(o):l.loadBlockContent();break;case"customID":e(".block",l.el).attr("id",o);break;case"customClass":var i=t.previousAttributes().customClass;i&&e(".block",l.$el).removeClass(i),n.addClass(o);break;case"customEnableAnimations":var s,d;o?(s=t.toJSON().customDataAnimations,d=null,n.processAnimations(s)):(s=null,d=t.toJSON().customDataAnimations,n.processAnimations(s,d));break;case"customDataAnimations":var s,d;s=t.toJSON().customDataAnimations,d=l.model.previousAttributes().customDataAnimations,n.processAnimations(s,d);break;default:n.changeResponsive(a,o),n.renderChangeSettingBoxModel(a,o,t)}})}}),AWEContent.Views.DrupalBlockPanel=AWEContent.Views.DefaultPanel.extend({panelName:"drupal_block",className:"awe-obj-panel drupal-block-panel",initPanel:function(){var t=this;AWEContent.Views.DefaultPanel.prototype.initPanel.call(this),e("#text-drupal-block-custom-title",this.$el).change(function(){t.editingModel.set("customTitle",e(this).val())}),e("#drupal-block-layout-tab",this.$el).initBoxModelPanel(this,"boxModelSettings"),e("#text-drupal-block-custom-id",this.$el).change(function(){t.editingModel.set("customID",e(this).val())}),e("#text-drupal-block-custom-classes",this.$el).change(function(){t.editingModel.set("customClass",e(this).val())}),e("#drupal-block-animations input[name=enabled_custom_animation]",this.el).change(function(l,n){t.editingModel.set("enableAnimation",parseInt(e(this).val())),n&&t.editingModel.set("animationData",JSON.stringify(n.animations))})},setPanelElementsValue:function(){var t=this,l=this.editingModel.toJSON();e("#text-drupal-block-custom-title",t.el).val(l.customTitle),e("#drupal-block-layout-tab",t.el).initBoxModel(l.boxModelSettings),e("#drupal-block-animations input[name=enabled_custom_animation]",this.el).val(l.enableAnimation).trigger("change"),e("#drupal-block-animations input[name=enabled_custom_animation]",this.el).attr("data-animations",l.animationData).data("view",this.editingModel.view),e("#text-drupal-block-custom-id",t.el).val(l.customID),e("#text-drupal-block-custom-classes",t.el).val(l.customClass)},buildPanel:function(){return{title:{type:"markup",markup:'<div class="awe-title"><h2>Drupal Block</h2></div>'},box_settings:{type:"section",custom_title:{type:"text_field",title:"Title",placeholder:"Custom block title"},layout_tab:{type:"tabs",tabs:[{tab_title:"Border",contents:{header_border:{type:"box_border",min_value:0,max_value:100,default_value:0}}},{tab_title:"Radius",contents:{header_boder_radius:{type:"box_model",model_type:"border_radius",min_value:0,max_value:100,allow_type:!0}}},{tab_title:"Padding",contents:{header_padding:{type:"box_model",model_type:"padding",allow_type:!0,min_value:0,max_value:100}}},{tab_title:"Margin",contents:{header_margin:{type:"box_model",model_type:"margin",allow_type:!0,min_value:0,max_value:100}}}]}},others:{type:"section",custom_id:{type:"text_field",title:"ID",placeholder:"Custom block ID"},custom_classes:{type:"text_field",title:"Class",placeholder:"Custom class"},animations:{type:"animations"}}}}}),e(document).ready(function(){AWEContent.Controllers.drupal_block=new AWEContent.Views.DrupalBlockController,AWEContent.Panels.drupal_block=new AWEContent.Views.DrupalBlockPanel})}(jQuery);